<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Repository Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        // 配置Tailwind自定义颜色，模仿GitHub的配色方案
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        github: {
                            primary: '#24292e',
                            secondary: '#3f4448',
                            accent: '#0366d6',
                            light: '#f6f8fa',
                            border: '#e1e4e8',
                            hover: '#f3f4f6',
                            danger: '#cb2431'
                        }
                    },
                    fontFamily: {
                        sans: ['-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .repo-item-hover {
                @apply hover:bg-github-hover transition-colors duration-150;
            }
            .file-icon {
                @apply w-5 h-5 inline-block mr-2;
            }
        }
    </style>
</head>
<body class="bg-white text-github-primary font-sans">
    <!-- 顶部导航栏 -->
    <header class="bg-github-primary text-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <!-- 左侧Logo和搜索 -->
                <div class="flex items-center space-x-4">
                    <a href="#" class="flex items-center">
                        <i class="fa fa-github text-2xl"></i>
                    </a>
                    <div class="hidden md:block relative">
                        <input type="text" placeholder="Search or jump to..." 
                            class="bg-github-secondary text-sm rounded-md py-1.5 pl-3 pr-8 w-64 focus:outline-none focus:ring-1 focus:ring-github-accent">
                    </div>
                    <nav class="hidden md:flex space-x-6">
                        <a href="#" class="text-sm font-medium hover:text-white transition-colors">Pull requests</a>
                        <a href="#" class="text-sm font-medium hover:text-white transition-colors">Issues</a>
                        <a href="#" class="text-sm font-medium hover:text-white transition-colors">Marketplace</a>
                        <a href="#" class="text-sm font-medium hover:text-white transition-colors">Explore</a>
                    </nav>
                </div>
                
                <!-- 右侧用户信息 -->
                <div class="flex items-center space-x-4">
                    <button class="text-gray-300 hover:text-white">
                        <i class="fa fa-bell-o"></i>
                    </button>
                    <div class="relative">
                        <button id="userMenuButton" class="flex items-center space-x-1 focus:outline-none">
                            <img src="https://picsum.photos/id/1005/200/200" alt="User avatar" class="w-8 h-8 rounded-full border-2 border-transparent">
                            <span class="hidden md:inline text-sm font-medium">abcdd12344</span>
                            <i class="fa fa-caret-down text-xs"></i>
                        </button>
                        <!-- 用户菜单 (默认隐藏) -->
                        <div id="userMenu" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-10 border border-github-border">
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-github-hover">Your profile</a>
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-github-hover">Your repositories</a>
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-github-hover">Settings</a>
                            <div class="border-t border-github-border my-1"></div>
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-github-hover" id="logoutButton">Sign out</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="container mx-auto px-4 py-6">
        <!-- 仓库路径导航 -->
        <div class="flex flex-wrap items-center text-sm mb-6">
            <a href="#" class="font-medium hover:text-github-accent">abcdd12344</a>
            <span class="mx-2 text-gray-500">/</span>
            <span id="currentRepoName" class="font-medium text-gray-900">Select a repository</span>
            <div id="filePathNav" class="hidden ml-2 flex flex-wrap items-center text-gray-500">
                <!-- 文件路径会动态添加到这里 -->
            </div>
        </div>

        <div class="flex flex-col md:flex-row gap-6">
            <!-- 左侧仓库列表 -->
            <div class="md:w-64 lg:w-72 flex-shrink-0">
                <div class="bg-github-light rounded-md p-4 sticky top-20">
                    <h2 class="font-semibold text-lg mb-4">Repositories</h2>
                    <div class="mb-4">
                        <input type="text" placeholder="Find a repository..." 
                            class="w-full bg-white border border-github-border rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-github-accent">
                    </div>
                    <ul id="repoList" class="space-y-1 max-h-[calc(100vh-300px)] overflow-y-auto">
                        <!-- 仓库列表会动态加载到这里 -->
                        <li class="flex items-center justify-center py-4 text-gray-500">
                            <i class="fa fa-spinner fa-spin mr-2"></i> Loading repositories...
                        </li>
                    </ul>
                </div>
            </div>

            <!-- 右侧文件内容区 -->
            <div class="flex-1">
                <!-- 仓库未选中状态 -->
                <div id="noRepoSelected" class="text-center py-16">
                    <i class="fa fa-folder-open text-5xl text-gray-300 mb-4"></i>
                    <h3 class="text-xl font-medium text-gray-700 mb-2">Select a repository</h3>
                    <p class="text-gray-500 max-w-md mx-auto">Choose a repository from the list to view its contents</p>
                </div>

                <!-- 仓库文件列表 (默认隐藏) -->
                <div id="repoContent" class="hidden">
                    <!-- 仓库工具栏 -->
                    <div class="flex flex-wrap items-center justify-between mb-6 pb-4 border-b border-github-border">
                        <div class="flex items-center space-x-4 mb-4 sm:mb-0">
                            <button class="inline-flex items-center px-3 py-1.5 border border-github-border rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-github-hover transition-colors">
                                <i class="fa fa-code-fork mr-2"></i> Code
                            </button>
                            <button class="inline-flex items-center px-3 py-1.5 border border-github-border rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-github-hover transition-colors">
                                <i class="fa fa-history mr-2"></i> History
                            </button>
                        </div>
                        <div>
                            <button class="inline-flex items-center px-3 py-1.5 border border-transparent rounded-md text-sm font-medium text-white bg-github-accent hover:bg-opacity-90 transition-colors">
                                <i class="fa fa-download mr-2"></i> Clone or download
                            </button>
                        </div>
                    </div>

                    <!-- 文件列表 -->
                    <div class="mb-8">
                        <div class="flex items-center py-2 px-4 bg-github-light border border-github-border rounded-t-md text-sm font-medium text-gray-500">
                            <div class="w-1/12">Type</div>
                            <div class="w-7/12">Name</div>
                            <div class="hidden md:block w-3/12">Last commit</div>
                            <div class="hidden lg:block w-1/12 text-right">Size</div>
                        </div>
                        <ul id="fileList" class="border-x border-github-border divide-y divide-github-border">
                            <!-- 文件列表会动态加载到这里 -->
                            <li class="flex items-center justify-center py-8 text-gray-500">
                                <i class="fa fa-spinner fa-spin mr-2"></i> Loading files...
                            </li>
                        </ul>
                    </div>

                    <!-- 文件内容预览 (默认隐藏) -->
                    <div id="filePreview" class="hidden">
                        <div class="flex items-center justify-between mb-4">
                            <h3 id="previewFileName" class="text-lg font-medium"></h3>
                            <button id="closePreview" class="text-gray-500 hover:text-gray-700">
                                <i class="fa fa-times"></i>
                            </button>
                        </div>
                        <div class="border border-github-border rounded-md overflow-hidden">
                            <div class="bg-github-light px-4 py-2 border-b border-github-border flex items-center text-sm">
                                <i class="fa fa-file-text-o mr-2 text-gray-500"></i>
                                <span id="previewFileInfo"></span>
                            </div>
                            <div id="fileContent" class="p-4 max-h-[600px] overflow-auto">
                                <!-- 文件内容会动态加载到这里 -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 加载错误提示 (默认隐藏) -->
                <div id="errorMessage" class="hidden bg-red-50 border border-red-200 rounded-md p-4 text-red-700">
                    <div class="flex items-start">
                        <i class="fa fa-exclamation-circle mt-0.5 mr-3 text-red-500"></i>
                        <div>
                            <h3 class="font-medium" id="errorTitle">Error</h3>
                            <p class="text-sm mt-1" id="errorDetails">An error occurred</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="bg-github-light border-t border-github-border mt-12">
        <div class="container mx-auto px-4 py-8">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center mb-4 md:mb-0">
                    <i class="fa fa-github text-xl mr-2"></i>
                    <span class="text-sm text-gray-600">© 2023 GitHub File Manager</span>
                </div>
                <div class="flex space-x-6 text-sm">
                    <a href="#" class="text-gray-600 hover:text-github-accent">Terms</a>
                    <a href="#" class="text-gray-600 hover:text-github-accent">Privacy</a>
                    <a href="#" class="text-gray-600 hover:text-github-accent">Security</a>
                    <a href="#" class="text-gray-600 hover:text-github-accent">Help</a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // 全局变量
        let githubToken = null;
        const username = 'abcdd12344';
        let currentRepo = null;
        let currentPath = '';
        let breadcrumbs = [];

        // DOM元素
        const repoListEl = document.getElementById('repoList');
        const fileListEl = document.getElementById('fileList');
        const noRepoSelectedEl = document.getElementById('noRepoSelected');
        const repoContentEl = document.getElementById('repoContent');
        const currentRepoNameEl = document.getElementById('currentRepoName');
        const filePathNavEl = document.getElementById('filePathNav');
        const filePreviewEl = document.getElementById('filePreview');
        const previewFileNameEl = document.getElementById('previewFileName');
        const previewFileInfoEl = document.getElementById('previewFileInfo');
        const fileContentEl = document.getElementById('fileContent');
        const closePreviewEl = document.getElementById('closePreview');
        const errorMessageEl = document.getElementById('errorMessage');
        const errorTitleEl = document.getElementById('errorTitle');
        const errorDetailsEl = document.getElementById('errorDetails');
        const userMenuButtonEl = document.getElementById('userMenuButton');
        const userMenuEl = document.getElementById('userMenu');

        // 初始化
        document.addEventListener('DOMContentLoaded', async () => {
            // 加载GitHub Token
            await loadGitHubToken();
            
            // 如果有token，加载仓库列表
            if (githubToken) {
                await loadRepositories();
            }
            
            // 事件监听
            closePreviewEl.addEventListener('click', closeFilePreview);
            userMenuButtonEl.addEventListener('click', toggleUserMenu);
            
            // 点击页面其他地方关闭用户菜单
            document.addEventListener('click', (e) => {
                if (!userMenuButtonEl.contains(e.target) && !userMenuEl.contains(e.target)) {
                    userMenuEl.classList.add('hidden');
                }
            });
        });

        // 加载GitHub Token
        async function loadGitHubToken() {
            try {
                // 从token.txt获取非ghp_部分的token
                const response = await fetch('token.txt');
                if (!response.ok) {
                    throw new Error('Failed to load token. Make sure token.txt exists in your repository.');
                }
                
                const tokenSuffix = await response.text();
                // 组合完整token (ghp_前缀 + 从文件获取的部分)
                githubToken = `ghp_${tokenSuffix.trim()}`;
            } catch (error) {
                showError('Authentication Error', 'Could not load authentication token: ' + error.message);
                console.error('Error loading GitHub token:', error);
            }
        }

        // 加载用户仓库列表
        async function loadRepositories() {
            try {
                repoListEl.innerHTML = '<li class="flex items-center justify-center py-4 text-gray-500"><i class="fa fa-spinner fa-spin mr-2"></i> Loading repositories...</li>';
                
                const response = await fetch(`https://api.github.com/users/${username}/repos`, {
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`Failed to fetch repositories: ${response.statusText}`);
                }
                
                const repositories = await response.json();
                
                if (repositories.length === 0) {
                    repoListEl.innerHTML = '<li class="py-4 text-center text-gray-500">No repositories found</li>';
                    return;
                }
                
                // 清空列表并添加仓库项
                repoListEl.innerHTML = '';
                repositories.forEach(repo => {
                    const li = document.createElement('li');
                    li.className = 'repo-item-hover rounded-md px-3 py-2';
                    li.innerHTML = `
                        <a href="#" class="flex items-center justify-between" data-repo="${repo.name}">
                            <div class="flex items-center">
                                <i class="fa fa-folder text-gray-400 mr-2"></i>
                                <span class="text-sm font-medium">${repo.name}</span>
                            </div>
                            <span class="text-xs text-gray-500">${repo.private ? 'Private' : 'Public'}</span>
                        </a>
                    `;
                    repoListEl.appendChild(li);
                    
                    // 添加点击事件
                    li.querySelector('a').addEventListener('click', (e) => {
                        e.preventDefault();
                        selectRepository(repo);
                    });
                });
                
            } catch (error) {
                repoListEl.innerHTML = '<li class="py-4 text-center text-red-500"><i class="fa fa-exclamation-circle mr-2"></i> Error loading repositories</li>';
                showError('Failed to Load Repositories', error.message);
                console.error('Error loading repositories:', error);
            }
        }

        // 选择仓库
        async function selectRepository(repo) {
            currentRepo = repo;
            currentPath = '';
            breadcrumbs = [{ name: repo.name, path: '' }];
            
            // 更新UI
            currentRepoNameEl.textContent = repo.name;
            updateBreadcrumbs();
            noRepoSelectedEl.classList.add('hidden');
            repoContentEl.classList.remove('hidden');
            filePreviewEl.classList.add('hidden');
            
            // 加载仓库内容
            await loadRepositoryContent();
            
            // 高亮选中的仓库
            document.querySelectorAll('#repoList a').forEach(link => {
                if (link.dataset.repo === repo.name) {
                    link.closest('li').classList.add('bg-white', 'font-medium');
                } else {
                    link.closest('li').classList.remove('bg-white', 'font-medium');
                }
            });
        }

        // 加载仓库内容
        async function loadRepositoryContent() {
            try {
                fileListEl.innerHTML = '<li class="flex items-center justify-center py-8 text-gray-500"><i class="fa fa-spinner fa-spin mr-2"></i> Loading files...</li>';
                
                let url = `https://api.github.com/repos/${username}/${currentRepo.name}/contents`;
                if (currentPath) {
                    url += `/${currentPath}`;
                }
                
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`Failed to fetch content: ${response.statusText}`);
                }
                
                const contents = await response.json();
                
                if (contents.length === 0) {
                    fileListEl.innerHTML = '<li class="flex items-center justify-center py-8 text-gray-500">This directory is empty</li>';
                    return;
                }
                
                // 分离文件夹和文件，文件夹在前
                const directories = contents.filter(item => item.type === 'dir');
                const files = contents.filter(item => item.type === 'file');
                
                // 清空列表并添加内容
                fileListEl.innerHTML = '';
                
                // 添加返回上级目录选项（如果不是根目录）
                if (currentPath) {
                    const li = document.createElement('li');
                    li.className = 'repo-item-hover';
                    li.innerHTML = `
                        <div class="flex items-center py-3 px-4">
                            <div class="w-1/12">
                                <i class="fa fa-level-up text-gray-400 file-icon"></i>
                            </div>
                            <div class="w-7/12 text-sm">
                                <a href="#" class="font-medium text-github-accent hover:underline" id="parentDirLink">..</a>
                            </div>
                            <div class="hidden md:block w-3/12 text-sm text-gray-500"></div>
                            <div class="hidden lg:block w-1/12 text-right text-sm text-gray-500"></div>
                        </div>
                    `;
                    fileListEl.appendChild(li);
                    
                    // 添加点击事件
                    li.querySelector('#parentDirLink').addEventListener('click', (e) => {
                        e.preventDefault();
                        navigateToParentDirectory();
                    });
                }
                
                // 添加文件夹
                directories.forEach(item => {
                    const li = document.createElement('li');
                    li.className = 'repo-item-hover';
                    li.innerHTML = `
                        <div class="flex items-center py-3 px-4">
                            <div class="w-1/12">
                                <i class="fa fa-folder text-yellow-500 file-icon"></i>
                            </div>
                            <div class="w-7/12 text-sm">
                                <a href="#" class="font-medium text-github-accent hover:underline" data-path="${item.path}" data-type="dir">${item.name}</a>
                            </div>
                            <div class="hidden md:block w-3/12 text-sm text-gray-500">
                                <span id="dirCommit-${item.path}">Loading...</span>
                            </div>
                            <div class="hidden lg:block w-1/12 text-right text-sm text-gray-500">-</div>
                        </div>
                    `;
                    fileListEl.appendChild(li);
                    
                    // 添加点击事件
                    li.querySelector('a').addEventListener('click', (e) => {
                        e.preventDefault();
                        navigateToDirectory(item.path, item.name);
                    });
                    
                    // 加载最后提交信息
                    loadLastCommitInfo(item.path, `dirCommit-${item.path}`);
                });
                
                // 添加文件
                files.forEach(item => {
                    const li = document.createElement('li');
                    li.className = 'repo-item-hover';
                    
                    // 确定文件图标
                    let fileIcon = 'fa-file-text-o';
                    if (item.name.endsWith('.js') || item.name.endsWith('.ts')) fileIcon = 'fa-file-code-o';
                    else if (item.name.endsWith('.html')) fileIcon = 'fa-file-html-o';
                    else if (item.name.endsWith('.css')) fileIcon = 'fa-file-code-o';
                    else if (item.name.endsWith('.md')) fileIcon = 'fa-file-text-o';
                    else if (item.name.endsWith('.json')) fileIcon = 'fa-file-code-o';
                    else if (item.name.endsWith('.png') || item.name.endsWith('.jpg') || item.name.endsWith('.gif')) fileIcon = 'fa-file-image-o';
                    
                    li.innerHTML = `
                        <div class="flex items-center py-3 px-4">
                            <div class="w-1/12">
                                <i class="fa ${fileIcon} text-gray-400 file-icon"></i>
                            </div>
                            <div class="w-7/12 text-sm">
                                <a href="#" class="font-medium text-github-accent hover:underline" data-path="${item.path}" data-type="file">${item.name}</a>
                            </div>
                            <div class="hidden md:block w-3/12 text-sm text-gray-500">
                                <span id="fileCommit-${item.path}">Loading...</span>
                            </div>
                            <div class="hidden lg:block w-1/12 text-right text-sm text-gray-500">${formatFileSize(item.size)}</div>
                        </div>
                    `;
                    fileListEl.appendChild(li);
                    
                    // 添加点击事件
                    li.querySelector('a').addEventListener('click', (e) => {
                        e.preventDefault();
                        viewFile(item);
                    });
                    
                    // 加载最后提交信息
                    loadLastCommitInfo(item.path, `fileCommit-${item.path}`);
                });
                
            } catch (error) {
                fileListEl.innerHTML = '<li class="flex items-center justify-center py-8 text-red-500"><i class="fa fa-exclamation-circle mr-2"></i> Error loading files</li>';
                showError('Failed to Load Files', error.message);
                console.error('Error loading repository content:', error);
            }
        }

        // 导航到子目录
        async function navigateToDirectory(path, name) {
            currentPath = path;
            breadcrumbs.push({ name, path });
            updateBreadcrumbs();
            await loadRepositoryContent();
        }

        // 导航到父目录
        async function navigateToParentDirectory() {
            if (breadcrumbs.length > 1) {
                breadcrumbs.pop();
                const lastCrumb = breadcrumbs[breadcrumbs.length - 1];
                currentPath = lastCrumb.path;
                updateBreadcrumbs();
                await loadRepositoryContent();
            }
        }

        // 查看文件内容
        async function viewFile(file) {
            try {
                // 更新预览区域标题
                previewFileNameEl.textContent = file.name;
                previewFileInfoEl.textContent = `${file.name} · ${formatFileSize(file.size)}`;
                
                // 显示加载状态
                fileContentEl.innerHTML = '<div class="flex justify-center py-8"><i class="fa fa-spinner fa-spin text-gray-400"></i></div>';
                filePreviewEl.classList.remove('hidden');
                
                // 获取文件内容
                // 对于二进制文件，我们不尝试显示内容
                const isBinary = file.name.match(/\.(png|jpg|jpeg|gif|zip|tar|gz|pdf)$/i);
                
                if (isBinary) {
                    fileContentEl.innerHTML = `
                        <div class="text-center py-8 text-gray-500">
                            <i class="fa fa-file-image-o text-4xl mb-4"></i>
                            <p>This is a binary file and cannot be previewed.</p>
                            <a href="${file.download_url}" class="inline-flex items-center mt-4 text-github-accent hover:underline" download>
                                <i class="fa fa-download mr-1"></i> Download file
                            </a>
                        </div>
                    `;
                    return;
                }
                
                // 对于文本文件，尝试获取并显示内容
                const response = await fetch(file.download_url, {
                    headers: {
                        'Authorization': `token ${githubToken}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`Failed to fetch file content: ${response.statusText}`);
                }
                
                const content = await response.text();
                
                // 尝试检测文件类型并进行语法高亮
                let fileType = 'text';
                if (file.name.endsWith('.js') || file.name.endsWith('.ts')) fileType = 'javascript';
                else if (file.name.endsWith('.html')) fileType = 'html';
                else if (file.name.endsWith('.css')) fileType = 'css';
                else if (file.name.endsWith('.md')) fileType = 'markdown';
                else if (file.name.endsWith('.json')) fileType = 'json';
                else if (file.name.endsWith('.py')) fileType = 'python';
                else if (file.name.endsWith('.java')) fileType = 'java';
                
                // 显示文件内容（简化的语法高亮模拟）
                if (fileType === 'markdown') {
                    // 简单的markdown解析
                    fileContentEl.innerHTML = `<div class="prose max-w-none">${simpleMarkdownParse(content)}</div>`;
                } else {
                    fileContentEl.innerHTML = `<pre class="bg-gray-50 p-4 rounded-md overflow-x-auto"><code class="text-sm">${escapeHtml(content)}</code></pre>`;
                }
                
            } catch (error) {
                fileContentEl.innerHTML = `
                    <div class="text-center py-8 text-red-500">
                        <i class="fa fa-exclamation-circle text-2xl mb-2"></i>
                        <p>Failed to load file content</p>
                    </div>
                `;
                showError('Failed to Load File', error.message);
                console.error('Error viewing file:', error);
            }
        }

        // 关闭文件预览
        function closeFilePreview() {
            filePreviewEl.classList.add('hidden');
        }

        // 加载最后提交信息
        async function loadLastCommitInfo(path, elementId) {
            try {
                const response = await fetch(`https://api.github.com/repos/${username}/${currentRepo.name}/commits?path=${encodeURIComponent(path)}&per_page=1`, {
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`Failed to fetch commits: ${response.statusText}`);
                }
                
                const commits = await response.json();
                
                if (commits.length > 0) {
                    const commit = commits[0];
                    const date = new Date(commit.commit.committer.date);
                    const timeAgo = formatTimeAgo(date);
                    
                    document.getElementById(elementId).innerHTML = `
                        <span class="truncate">${commit.commit.message.split('\n')[0]}</span>
                        <div class="text-xs">
                            ${timeAgo} by ${commit.author ? commit.author.login : commit.commit.committer.name}
                        </div>
                    `;
                } else {
                    document.getElementById(elementId).textContent = 'No commits';
                }
                
            } catch (error) {
                document.getElementById(elementId).textContent = 'Error loading commit info';
                console.error('Error loading last commit info:', error);
            }
        }

        // 更新面包屑导航
        function updateBreadcrumbs() {
            filePathNavEl.innerHTML = '';
            filePathNavEl.classList.remove('hidden');
            
            breadcrumbs.forEach((crumb, index) => {
                if (index > 0) {
                    const separator = document.createElement('span');
                    separator.className = 'mx-2 text-gray-500';
                    separator.textContent = '/';
                    filePathNavEl.appendChild(separator);
                }
                
                const link = document.createElement('a');
                link.textContent = crumb.name;
                
                if (index === breadcrumbs.length - 1) {
                    // 当前目录，不添加链接
                    link.className = 'text-gray-900 font-medium';
                } else {
                    // 不是当前目录，添加链接
                    link.className = 'text-gray-500 hover:text-github-accent';
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        navigateToBreadcrumb(index);
                    });
                }
                
                filePathNavEl.appendChild(link);
            });
        }

        // 导航到面包屑指定的路径
        async function navigateToBreadcrumb(index) {
            if (index < breadcrumbs.length - 1) {
                breadcrumbs = breadcrumbs.slice(0, index + 1);
                const lastCrumb = breadcrumbs[breadcrumbs.length - 1];
                currentPath = lastCrumb.path;
                updateBreadcrumbs();
                await loadRepositoryContent();
            }
        }

        // 显示错误信息
        function showError(title, details) {
            errorTitleEl.textContent = title;
            errorDetailsEl.textContent = details;
            errorMessageEl.classList.remove('hidden');
            
            // 5秒后自动隐藏错误信息
            setTimeout(() => {
                errorMessageEl.classList.add('hidden');
            }, 5000);
        }

        // 切换用户菜单
        function toggleUserMenu() {
            userMenuEl.classList.toggle('hidden');
        }

        // 工具函数：格式化文件大小
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // 工具函数：格式化时间为"多久前"
        function formatTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            
            let interval = Math.floor(seconds / 31536000);
            if (interval >= 1) return interval + " year" + (interval === 1 ? "" : "s") + " ago";
            
            interval = Math.floor(seconds / 2592000);
            if (interval >= 1) return interval + " month" + (interval === 1 ? "" : "s") + " ago";
            
            interval = Math.floor(seconds / 86400);
            if (interval >= 1) return interval + " day" + (interval === 1 ? "" : "s") + " ago";
            
            interval = Math.floor(seconds / 3600);
            if (interval >= 1) return interval + " hour" + (interval === 1 ? "" : "s") + " ago";
            
            interval = Math.floor(seconds / 60);
            if (interval >= 1) return interval + " minute" + (interval === 1 ? "" : "s") + " ago";
            
            return Math.floor(seconds) + " second" + (seconds === 1 ? "" : "s") + " ago";
        }

        // 工具函数：简单的Markdown解析
        function simpleMarkdownParse(markdown) {
            // 转义HTML
            let html = escapeHtml(markdown);
            
            // 标题
            html = html.replace(/^# (.*$)/gm, '<h1 class="text-2xl font-bold mt-6 mb-4">$1</h1>');
            html = html.replace(/^## (.*$)/gm, '<h2 class="text-xl font-bold mt-5 mb-3">$1</h2>');
            html = html.replace(/^### (.*$)/gm, '<h3 class="text-lg font-bold mt-4 mb-2">$1</h3>');
            
            // 粗体和斜体
            html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            html = html.replace(/\*(.*?)\*/g, '<em>$1</em>');
            
            // 链接
            html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" class="text-github-accent hover:underline" target="_blank">$1</a>');
            
            // 列表
            html = html.replace(/^- (.*$)/gm, '<li class="ml-6 mb-1">$1</li>');
            html = html.replace(/(<li.*?>.*?<\/li>)\s+(?=<li)/gs, '$1'); // 合并列表项
            html = html.replace(/(<li.*?>.*?<\/li>)+/gs, '<ul class="list-disc mb-4">$&</ul>');
            
            // 段落
            html = html.replace(/^(?!<h|<ul|<li)(.*$)/gm, '<p class="mb-4">$1</p>');
            
            // 代码块
            html = html.replace(/```(.*?)\n([\s\S]*?)```/g, '<pre class="bg-gray-50 p-4 rounded-md overflow-x-auto my-4"><code class="text-sm">$2</code></pre>');
            
            // 换行
            html = html.replace(/\n/g, '<br>');
            
            return html;
        }

        // 工具函数：转义HTML
        function escapeHtml(text) {
            return text
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
    </script>
</body>
</html>
