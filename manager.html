<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>GitHub ä»“åº“ç®¡ç†å™¨</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <!-- Primer CSS (GitHubå®˜æ–¹æ ·å¼) -->
    <link rel="stylesheet" href="https://unpkg.com/@primer/css/dist/primer.css">
    <style>
        body { background: #f6f8fa; min-height: 100vh; }
        .Header { background: #24292e; color: #fff; padding: 16px 32px; font-size: 1.5em; letter-spacing: 1px; display: flex; align-items: center; }
        .Header img { width: 32px; margin-right: 10px; }
        .repo-header { display:flex; align-items:center; padding:24px 0 16px 0; border-bottom:1px solid #d0d7de; }
        .repo-header h1 { margin:0 20px 0 0; font-size:1.5em; font-weight:bold; }
        .repo-header .Label { margin-right:20px; }
        .repo-header .btn { margin-right:8px; }
        .branch-switch { margin-right:32px; }
        .UnderlineNav { margin:26px 0 18px 0; }
        .repo-content { }
        .file-navigation { display:flex; align-items:center; gap:8px; margin-bottom:12px; }
        .file-navigation .btn { font-size:1em; }
        .file-navigation .select-menu { margin-right:20px; }
        .files-table { width:100%; border-collapse:collapse; background:#fff; margin-bottom:22px; }
        .files-table th, .files-table td { padding:9px 8px; border-bottom:1px solid #eaecef; font-size:1em; }
        .files-table th { background:#f6f8fa; font-weight:600; }
        .files-table td a { color:#0969da; text-decoration:none; }
        .files-table td a:hover { text-decoration:underline; }
        .file-ops .btn { margin-right:7px; font-size:0.9em; }
        .commit-history, .actions-status { margin:0 0 32px 0; }
        .readme-box { margin:24px 0; }
        .readme-box .Box-body { background:#fff; padding:18px; }
        .commitmsg-box { margin-left:12px; }
        .commitmsg-box input { width:200px; }
        @media (max-width:800px) {
            .container-xl { padding:0 4vw; }
        }
        @media (max-width:600px) {
            .file-navigation, .repo-header { flex-direction:column; align-items:flex-start; }
            .repo-header h1 { font-size:1.1em; margin-bottom:8px;}
            .commitmsg-box input { width:120px;}
        }
    </style>
</head>
<body>
    <div class="Header">
        <img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub">
        <span>abcdd12344 / abcdd12344.github.io</span>
    </div>
    <div class="container-xl px-3 my-4">
        <div class="repo-header">
            <h1>abcdd12344/abcdd12344.github.io</h1>
            <span class="Label Label--success">Public</span>
            <button class="btn btn-sm btn-outline" onclick="starRepo()">â­ Star</button>
            <button class="btn btn-sm btn-outline" onclick="forkRepo()">ğŸ´ Fork</button>
            <span class="branch-switch select-menu">
                <select id="branchSelect" onchange="changeBranch(this.value)" class="form-select">
                    <option value="main">main</option>
                </select>
            </span>
        </div>
        <nav class="UnderlineNav">
            <div class="UnderlineNav-body">
                <a id="tab-code" href="javascript:void(0);" class="UnderlineNav-item selected" onclick="showTab('code')">Code</a>
                <a id="tab-commits" href="javascript:void(0);" class="UnderlineNav-item" onclick="showTab('commits')">Commits</a>
                <a id="tab-actions" href="javascript:void(0);" class="UnderlineNav-item" onclick="showTab('actions')">Actions</a>
            </div>
        </nav>
        <div id="repo-content">
            <!-- Code Tab -->
            <div id="code-tab-content">
                <div class="file-navigation">
                    <span style="font-weight:600;">å½“å‰è·¯å¾„ï¼š</span><span id="ghPath"></span>
                    <button class="btn btn-sm btn-primary" onclick="showNewFile()">æ–°å»ºæ–‡ä»¶</button>
                    <button class="btn btn-sm btn-primary" onclick="showNewDir()">æ–°å»ºç›®å½•</button>
                    <button class="btn btn-sm btn-primary" onclick="showUploadFile()">ä¸Šä¼ æ–‡ä»¶</button>
                    <button class="btn btn-sm btn-primary" onclick="showUploadFolder()">ä¸Šä¼ æ–‡ä»¶å¤¹</button>
                    <span class="commitmsg-box">
                        <input id="commitMsgInput" type="text" placeholder="æäº¤è¯´æ˜" value="é€šè¿‡ç®¡ç†å™¨ä¿®æ”¹" onchange="commitMsg=this.value">
                    </span>
                </div>
                <table class="files-table" id="ghTable">
                    <thead>
                        <tr>
                            <th>ç±»å‹</th>
                            <th>æ–‡ä»¶/ç›®å½•å</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="ghFiles"></tbody>
                </table>
                <div class="readme-box Box mt-4">
                    <div class="Box-header"><h3 class="Box-title">README.md</h3></div>
                    <div class="Box-body" id="readme-content"></div>
                </div>
            </div>
            <!-- Commits Tab -->
            <div id="commits-tab-content" style="display:none;">
                <div class="commit-history Box">
                    <div class="Box-header"><h3 class="Box-title">æœ€è¿‘æäº¤è®°å½•</h3></div>
                    <div class="Box-body" id="commit-history-content"></div>
                </div>
            </div>
                    </thead>
                    <tbody id="ghFiles"></tbody>
                </table>
                <div class="readme-box Box mt-4">
                    <div class="Box-header"><h3 class="Box-title">README.md</h3></div>
                    <div class="Box-body" id="readme-content"></div>
                </div>
            </div>
            <!-- Commits Tab -->
            <div id="commits-tab-content" style="display:none;">
                <div class="commit-history Box">
                    <div class="Box-header"><h3 class="Box-title">æœ€è¿‘æäº¤è®°å½•</h3></div>
                    <div class="Box-body" id="commit-history-content"></div>
                </div>
            </div>
            <!-- Actions Tab -->
            <div id="actions-tab-content" style="display:none;">
                <div class="actions-status Box">
                    <div class="Box-header"><h3 class="Box-title">æœ€è¿‘ Actions çŠ¶æ€</h3></div>
                    <div class="Box-body" id="actions-status-content"></div>
                </div>
            </div>
        </div>
        <div class="gh-status" id="ghStatus"></div>
        <input type="file" id="ghUploadInput" style="display:none;" />
        <input type="file" id="ghUploadFolderInput" style="display:none;" webkitdirectory directory multiple />
    </div>
    <!-- ç¼–è¾‘å™¨å®Œæ•´é¡µé¢å¼¹çª—å±‚ -->
    <div class="editor-page-bg" id="editorPageBg">
        <div class="editor-page" id="editorPage">
            <button class="editor-close" onclick="closeEditorPage()" title="å…³é—­">&times;</button>
            <div class="editor-header">
                <span class="editor-filename" id="editorFilename"></span>
                <div class="editor-actions">
                    <input id="editorCommitMsgInput" type="text" value="é€šè¿‡ç®¡ç†å™¨ä¿®æ”¹" placeholder="æäº¤è¯´æ˜" style="width:180px;">
                    <button onclick="saveEditorEdit()" class="btn btn-primary">ä¿å­˜</button>
                    <button onclick="closeEditorPage()" class="btn btn-danger">å–æ¶ˆ</button>
                </div>
            </div>
            <div class="editor-content">
                <textarea class="editor-textarea" id="editorTextarea"></textarea>
            </div>
        </div>
    </div>
    <!-- é‡å‘½åå¼¹çª—å±‚ -->
    <div class="gh-rename-bg" id="ghRenameBg">
        <div class="gh-rename-modal" id="ghRenameModal">
            <button class="gh-rename-close" onclick="closeRenameModal()" title="å…³é—­é‡å‘½å">&times;</button>
            <div class="gh-rename-title" id="ghRenameTitle"></div>
            <input class="gh-rename-input" id="ghRenameInput" type="text" value="">
            <div class="gh-rename-actions">
                <button onclick="doRenameFile()" class="btn btn-primary">ç¡®å®š</button>
                <button onclick="closeRenameModal()" class="btn btn-danger">å–æ¶ˆ</button>
            </div>
        </div>
    </div>
    <!-- marked.js for README markdown render -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
    // ä»“åº“é…ç½®
    const owner = "abcdd12344";
    const repo = "abcdd12344.github.io";
    let branch = "main";
    let curPath = "";
    let commitMsg = "é€šè¿‡ç®¡ç†å™¨ä¿®æ”¹";
    let editingFile = null, fileSha = "", lastFullScreenType = "", lastFullScreenPath = "", lastFullScreenContent = "";
    let renameOldPath = "", renameOldSha = "", renameType = "";
    let editorActiveFile = null, editorActiveSha = "", editorActiveContent = "";

    // Tabsåˆ‡æ¢
    function showTab(tab) {
        ["code","commits","actions"].forEach(t=>{
            document.getElementById(`${t}-tab-content`).style.display = (t===tab)?"block":"none";
            document.getElementById(`tab-${t}`).classList.toggle("selected",t===tab);
        });
        if(tab==="commits") loadCommits();
        if(tab==="actions") loadActions();
        if(tab==="code") { loadFiles(curPath); loadReadme(); }
    }

    // ä»“åº“åˆ†æ”¯é€‰æ‹©ï¼ˆä»…å±•ç¤ºmainåˆ†æ”¯ï¼Œå¯æ‰©å±•åˆ†æ”¯åˆ—è¡¨ï¼‰
    function changeBranch(b) { branch = b; loadFiles(curPath); loadReadme(); }

    function showStatus(msg, color="#238636") {
        const el = document.getElementById("ghStatus");
        el.textContent = msg;
        el.style.color = color;
        setTimeout(()=>{ el.textContent=""; }, 2500);
    }
    function showPath() { document.getElementById("ghPath").innerText = curPath?curPath:"/"; }

    function showActionsBar() {
        document.getElementById("commitMsgInput").value = commitMsg;
    }

    // æ–‡ä»¶åˆ—è¡¨å’Œæ“ä½œ
    async function loadFiles(path="") {
        showPath();
        let api = `https://api.github.com/repos/${owner}/${repo}/contents/${path}?ref=${branch}`;
        const res = await fetch(api);
        if (!res.ok) {
            document.getElementById("ghFiles").innerHTML = `<tr><td colspan="3">æ— æ³•è¯»å–æ–‡ä»¶åˆ—è¡¨</td></tr>`;
            showActionsBar();
            return;
        }
        let files = await res.json();
        if (!Array.isArray(files)) files = [files];
        files.sort((a,b)=>(a.type===b.type)?a.name.localeCompare(b.name):(a.type==="dir"?-1:1));
        let html = "";
        if(path){
            const upPath = path.split('/').slice(0,-1).join('/');
            html += `<tr>
                <td>â†©ï¸</td>
                <td><a href="javascript:void(0)" onclick="goDir('${upPath}')">è¿”å›ä¸Šçº§</a></td>
                <td></td>
            </tr>`;
        }
        for(const f of files){
            html += `<tr>
                <td>${f.type==="dir"?"ğŸ“":"ğŸ“„"}</td>
                <td><a href="javascript:void(0)" onclick="${f.type==="dir"?`goDir('${f.path}')`:`openEditorPage('${f.path}','${f.sha}')`}">${f.name}</a></td>
                <td class="file-ops">
                ${f.type==="file"?`
                    <button class="btn btn-sm btn-primary" onclick="showRenameModal('${f.path}','${f.sha}','file')">é‡å‘½å</button>
                    <button class="btn btn-sm btn-danger" onclick="delFile('${f.path}','${f.sha}')">åˆ é™¤</button>
                    <button class="btn btn-sm btn-outline" onclick="downloadFile('${f.path}')">ä¸‹è½½</button>
                `:`
                    <button class="btn btn-sm btn-primary" onclick="showRenameModal('${f.path}','','dir')">é‡å‘½å</button>
                    <button class="btn btn-sm btn-danger" onclick="delDir('${f.path}')">åˆ é™¤</button>
                    <button class="btn btn-sm btn-outline" onclick="downloadFolder('${f.path}')">ä¸‹è½½</button>
                `}
                </td>
            </tr>`;
        }
        document.getElementById("ghFiles").innerHTML = html;
        showActionsBar();
    }
    window.goDir = function(path){ curPath = path; loadFiles(curPath); };
    // README æ¸²æŸ“
    async function loadReadme() {
        const url = `https://api.github.com/repos/${owner}/${repo}/readme?ref=${branch}`;
        const res = await fetch(url);
        if(res.ok){
            const data = await res.json();
            const md = atob(data.content.replace(/\n/g,""));
            document.getElementById("readme-content").innerHTML = marked.parse(md);
        }else{
            document.getElementById("readme-content").innerHTML = "<span style='color:#aaa;'>æš‚æ—  README.md</span>";
        }
    }
    // æœ€è¿‘æäº¤å†å²
    async function loadCommits(){
        const api = `https://api.github.com/repos/${owner}/${repo}/commits?sha=${branch}&per_page=10`;
        const res = await fetch(api);
        if(!res.ok){ document.getElementById("commit-history-content").innerHTML = "æ— æ³•è·å–æäº¤è®°å½•"; return;}
        const data = await res.json();
        let html = "<ul>";
        for(const c of data){
            html += `<li>
                <a href="${c.html_url}" target="_blank">${c.commit.message.slice(0,80)}</a>
                by <span style="color:#0969da">${c.commit.author.name}</span>
                <span style="color:#57606a">(${c.commit.author.date.replace('T',' ').replace('Z','')})</span>
            </li>`;
        }
        html += "</ul>";
        document.getElementById("commit-history-content").innerHTML = html;
    }
    // æœ€è¿‘ Actions çŠ¶æ€
    async function loadActions(){
        const api = `https://api.github.com/repos/${owner}/${repo}/actions/runs?per_page=8`;
        const res = await fetch(api);
        if(!res.ok){ document.getElementById("actions-status-content").innerHTML = "æ— æ³•è·å– Actions çŠ¶æ€"; return;}
        const data = await res.json();
        let html = "<ul>";
        for(const run of data.workflow_runs||[]){
            html += `<li>
                <a href="${run.html_url}" target="_blank">${run.name||"å·¥ä½œæµ"} #${run.run_number}</a>
                çŠ¶æ€: <span style="color:${run.status=='completed'?(run.conclusion=='success'?'#238636':'#cf222e'):'#f59e42'}">${run.status}${run.conclusion?' ('+run.conclusion+')':''}</span>
                <span style="color:#57606a">(${run.created_at.replace('T',' ').replace('Z','')})</span>
            </li>`;
        }
        html += "</ul>";
        document.getElementById("actions-status-content").innerHTML = html;
    }

    // æ–‡ä»¶/ç›®å½•æ“ä½œ
    window.openEditorPage = async function(path, sha) {
        editorActiveFile = path;
        editorActiveSha = sha;
        editorActiveContent = "";
        document.getElementById("editorPageBg").style.display = "flex";
        document.getElementById("editorFilename").textContent = path;
        document.getElementById("editorCommitMsgInput").value = commitMsg;
        document.getElementById("editorTextarea").value = "æ­£åœ¨åŠ è½½å†…å®¹...";
        const ext = path.split('.').pop().toLowerCase();
        // åªå…è®¸æ–‡æœ¬æ–‡ä»¶ç¼–è¾‘
        if(["md","txt","json","js","ts","css","html","py","java","c","cpp","go","rs","php","yaml","yml"].includes(ext)||ext.length<=5){
            const url = `https://api.github.com/repos/${owner}/${repo}/contents/${path}?ref=${branch}`;
            const res = await fetch(url);
            if(!res.ok){
                document.getElementById("editorTextarea").value = "(æ— æ³•è¯»å–æ–‡ä»¶å†…å®¹)";
                editorActiveContent="";
                return;
            }
            const data = await res.json();
            let content = atob(data.content.replace(/\n/g,""));
            document.getElementById("editorTextarea").value = content;
            editorActiveContent = content;
        }else{
            document.getElementById("editorTextarea").value = `ä¸æ”¯æŒæ­¤ç±»å‹æ–‡ä»¶çš„åœ¨çº¿ç¼–è¾‘ï¼Œè¯·ä¸‹è½½æ–‡ä»¶åæœ¬åœ°ä¿®æ”¹ã€‚\n\næ–‡ä»¶ç±»å‹ï¼š${ext}`;
            document.getElementById("editorTextarea").disabled = true;
        }
    }
    window.closeEditorPage = function(){
        document.getElementById("editorPageBg").style.display="none";
        document.getElementById("editorTextarea").disabled = false;
        editorActiveFile = null;
        editorActiveSha = "";
        editorActiveContent = "";
    };
    document.getElementById("editorPageBg").onclick=function(e){ if(e.target===this) closeEditorPage(); };
    window.saveEditorEdit = async function() {
        if(!editorActiveFile) return;
        const val = document.getElementById("editorTextarea").value;
        let token = localStorage.getItem("gh_token")||"";
        if(!token){ token = ""; }
        let msg = document.getElementById("editorCommitMsgInput").value;
        commitMsg = msg;
        showStatus("æ­£åœ¨ä¿å­˜...", "#0969da");
        const content = btoa(unescape(encodeURIComponent(val)));
        const url = `https://api.github.com/repos/${owner}/${repo}/contents/${editorActiveFile}`;
        const res = await fetch(url, {
            method:"PUT",
            headers:{ "Authorization":"token "+token, "Accept":"application/vnd.github+json" },
            body:JSON.stringify({ message:msg, content:content, sha:editorActiveSha, branch:branch })
        });
        const data = await res.json();
        if(res.ok){ showStatus("ä¿å­˜æˆåŠŸï¼"); loadFiles(curPath); closeEditorPage(); }
        else{ showStatus("ä¿å­˜å¤±è´¥: "+(data.message||""), "#cf222e"); }
    }
    window.downloadFile = function(path) {
        const rawUrl = `https://raw.githubusercontent.com/${owner}/${repo}/${branch}/${path}`;
        const a = document.createElement("a");
        a.href = rawUrl; a.download = getFileName(path);
        document.body.appendChild(a); a.click(); document.body.removeChild(a);
    };
    window.downloadFolder = async function(path) {
        showStatus("æ­£åœ¨æ‰“åŒ…æ–‡ä»¶å¤¹...", "#0969da");
        if(!window.JSZip){
            const script = document.createElement("script");
            script.src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js";
            document.body.appendChild(script);
            await new Promise(r=>{script.onload=r});
        }
        const zip = new window.JSZip();
        async function addDirToZip(dir, zipFolder){
            const api = `https://api.github.com/repos/${owner}/${repo}/contents/${dir}?ref=${branch}`;
            const res = await fetch(api); if(!res.ok) return;
            let items = await res.json();
            if(!Array.isArray(items)) items=[items];
            for(const item of items){
                if(item.type==="dir") addDirToZip(item.path, zipFolder.folder(getFileName(item.path)));
                else if(item.type==="file"){
                    const fileRes = await fetch(item.download_url);
                    const blob = await fileRes.blob();
                    zipFolder.file(getFileName(item.path), blob);
                }
            }
        }
        await addDirToZip(path, zip.folder(getFileName(path)));
        const content = await zip.generateAsync({type:"blob"});
        const a = document.createElement("a");
        a.href=URL.createObjectURL(content); a.download=getFileName(path)+".zip";
        document.body.appendChild(a); a.click(); document.body.removeChild(a);
        showStatus("æ–‡ä»¶å¤¹å·²ä¸‹è½½ä¸ºzipï¼");
    };
    window.delDir = async function(path){
        if(!confirm(`ç¡®å®šè¦åˆ é™¤æ–‡ä»¶å¤¹ï¼š${path} å—ï¼Ÿ`)) return;
        let token = localStorage.getItem("gh_token")||"";
        if(!token){ token = ""; }
        showStatus("æ­£åœ¨é€’å½’åˆ é™¤...", "#cf222e");
        async function delDirRecursively(dir){
            const api = `https://api.github.com/repos/${owner}/${repo}/contents/${dir}?ref=${branch}`;
            const res = await fetch(api); if(!res.ok) return;
            let items = await res.json();
            if(!Array.isArray(items)) items=[items];
            for(const item of items){
                if(item.type==="dir") await delDirRecursively(item.path);
                else if(item.type==="file"){
                    await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${item.path}`,{
                        method:"DELETE",
                        headers:{ "Authorization":"token "+token, "Accept":"application/vnd.github+json" },
                        body:JSON.stringify({ message:`Delete ${item.path} (in folder ${dir})`, sha:item.sha, branch:branch })
                    });
                }
            }
            await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${dir}/.keep`,{
                method:"DELETE",
                headers:{ "Authorization":"token "+token, "Accept":"application/vnd.github+json" },
                body:JSON.stringify({ message:`Delete .keep for folder ${dir}`, sha:"", branch:branch })
            });
        }
        await delDirRecursively(path);
        showStatus("æ–‡ä»¶å¤¹åˆ é™¤å®Œæˆï¼");
        loadFiles(curPath);
    };
    window.showRenameModal = function(path, sha, type){
        renameOldPath = path; renameOldSha = sha; renameType = type;
        document.getElementById("ghRenameBg").style.display = "flex";
        document.getElementById("ghRenameTitle").textContent = `é‡å‘½å${type==="dir"?"ç›®å½•":"æ–‡ä»¶"}: ${path}`;
        document.getElementById("ghRenameInput").value = getFileName(path);
    }
    window.closeRenameModal = function(){ renameOldPath=""; renameOldSha=""; renameType=""; document.getElementById("ghRenameBg").style.display="none"; };
    document.getElementById("ghRenameBg").onclick=function(e){ if(e.target===this) closeRenameModal(); };
    window.doRenameFile = async function() {
        const newName = document.getElementById("ghRenameInput").value.trim();
        if(!newName||!renameOldPath) return showStatus("è¯·è¾“å…¥æ–°æ–‡ä»¶å", "#cf222e");
        if(getFileName(renameOldPath)===newName) return showStatus("æ–‡ä»¶åæœªä¿®æ”¹", "#cf222e");
        const newPath = getParentPath(renameOldPath)?getParentPath(renameOldPath)+'/'+newName:newName;
        let token = localStorage.getItem("gh_token")||"";
        if(!token){ token = ""; }
        showStatus("æ­£åœ¨é‡å‘½å...", "#0969da");
        if(renameType==="dir"){
            const api = `https://api.github.com/repos/${owner}/${repo}/contents/${renameOldPath}?ref=${branch}`;
            const res = await fetch(api); if(!res.ok) return showStatus("æ— æ³•è·å–ç›®å½•å†…å®¹", "#cf222e");
            let items = await res.json();
            if(!Array.isArray(items)) items=[items];
            let ok = true;
            for(const item of items){
                const subNewPath = newPath+"/"+getFileName(item.path);
                let data = item;
                if(!data.content){
                    const r = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${item.path}?ref=${branch}`);
                    if(!r.ok) continue;
                    data = await r.json();
                }
                const base64Content = data.content?data.content.replace(/\n/g,""):"";
                const createUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${subNewPath}`;
                const createRes = await fetch(createUrl,{
                    method:"PUT",
                    headers:{ "Authorization":"token "+token, "Accept":"application/vnd.github+json" },
                    body:JSON.stringify({ message:`Rename (move) ${subNewPath} from ${item.path}`, content:base64Content, branch:branch })
                });
                if(!createRes.ok){ ok=false; break;}
                const deleteUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${item.path}`;
                await fetch(deleteUrl,{
                    method:"DELETE",
                    headers:{ "Authorization":"token "+token, "Accept":"application/vnd.github+json" },
                    body:JSON.stringify({ message:`Delete ${item.path} after renaming to ${subNewPath}`, sha:item.sha, branch:branch })
                });
            }
            if(ok){ showStatus("ç›®å½•é‡å‘½åæˆåŠŸï¼"); loadFiles(curPath); closeRenameModal(); }
            else{ showStatus("ç›®å½•é‡å‘½åå¤±è´¥", "#cf222e"); }
        }else{
            let base64Content = null;
            const url = `https://api.github.com/repos/${owner}/${repo}/contents/${renameOldPath}?ref=${branch}`;
            const res = await fetch(url); if(!res.ok){ showStatus("è·å–åŸæ–‡ä»¶å†…å®¹å¤±è´¥", "#cf222e"); return; }
            const data = await res.json();
            base64Content = data.content.replace(/\n/g,"");
            const createUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${newPath}`;
            const createRes = await fetch(createUrl,{
                method:"PUT",
                headers:{ "Authorization":"token "+token, "Accept":"application/vnd.github+json" },
                body:JSON.stringify({ message:`Rename (create) ${newPath} from ${renameOldPath}`, content:base64Content, branch:branch })
            });
            const createData = await createRes.json();
            if(createRes.ok){
                const deleteUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${renameOldPath}`;
                const deleteRes = await fetch(deleteUrl,{
                    method:"DELETE",
                    headers:{ "Authorization":"token "+token, "Accept":"application/vnd.github+json" },
                    body:JSON.stringify({ message:`Rename (delete) ${renameOldPath} after renaming to ${newPath}`, sha:renameOldSha, branch:branch })
                });
                const deleteData = await deleteRes.json();
                if(deleteRes.ok){
                    showStatus("é‡å‘½åæˆåŠŸï¼"); loadFiles(curPath); closeRenameModal();
                }else{
                    showStatus("é‡å‘½åååˆ é™¤åŸæ–‡ä»¶å¤±è´¥: "+(deleteData.message||""), "#cf222e");
                }
            }else{
                showStatus("é‡å‘½åå¤±è´¥: "+(createData.message||""), "#cf222e");
            }
        }
    };
    function getFileName(path){ const arr = path.split('/'); return arr[arr.length-1]; }
    function getParentPath(path){ const arr = path.split('/'); arr.pop(); return arr.join('/'); }
    window.delFile = async function(path, sha) {
        if(!confirm(`ç¡®å®šè¦åˆ é™¤æ–‡ä»¶ï¼š${path} å—ï¼Ÿ`)) return;
        let token = localStorage.getItem("gh_token")||"";
        if(!token){ token = ""; }
        showStatus("æ­£åœ¨åˆ é™¤...", "#cf222e");
        const url = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
        const res = await fetch(url, {
            method:"DELETE",
            headers:{ "Authorization":"token "+token, "Accept":"application/vnd.github+json" },
            body:JSON.stringify({ message:`Delete ${path}`, sha:sha, branch:branch })
        });
        const data = await res.json();
        if(res.ok){ showStatus("åˆ é™¤æˆåŠŸï¼"); loadFiles(curPath);}
        else{ showStatus("åˆ é™¤å¤±è´¥: "+(data.message||""), "#cf222e"); }
    }
    window.showUploadFile = function(){ document.getElementById('ghUploadInput').value=''; document.getElementById('ghUploadInput').click(); }
    document.getElementById('ghUploadInput').onchange = async function(evt) {
        const file = evt.target.files[0]; if(!file) return;
        let filePath = curPath?curPath+"/"+file.name:file.name;
        let token = localStorage.getItem("gh_token")||""; if(!token){ token = ""; }
        showStatus("æ­£åœ¨ä¸Šä¼ ...", "#0969da");
        const reader = new FileReader();
        reader.onload = async function(e){
            let result = e.target.result; let base64 = result.split(',')[1];
            const url = `https://api.github.com/repos/${owner}/${repo}/contents/${filePath}`;
            const res = await fetch(url, {
                method:"PUT",
                headers:{ "Authorization":"token "+token, "Accept":"application/vnd.github+json" },
                body:JSON.stringify({ message:commitMsg, content:base64, branch:branch })
            });
            const data = await res.json();
            if(res.ok){ showStatus("ä¸Šä¼ æˆåŠŸï¼"); loadFiles(curPath);}
            else{ showStatus("ä¸Šä¼ å¤±è´¥: "+(data.message||""), "#cf222e"); }
        };
        reader.readAsDataURL(file);
    };
    window.showUploadFolder = function(){ document.getElementById('ghUploadFolderInput').value=''; document.getElementById('ghUploadFolderInput').click(); }
    document.getElementById('ghUploadFolderInput').onchange = async function(evt) {
        const files = evt.target.files; if(!files||files.length===0) return;
        let token = localStorage.getItem("gh_token")||""; if(!token){ token = ""; }
        showStatus("æ­£åœ¨ä¸Šä¼ æ–‡ä»¶å¤¹...", "#0969da");
        let count=0, failed=0;
        for(let i=0;i<files.length;i++){
            const file = files[i];
            let filePath = curPath?curPath+"/"+file.webkitRelativePath:file.webkitRelativePath;
            const reader = new FileReader();
            await new Promise(resolve=>{
                reader.onload = async function(e){
                    let result = e.target.result; let base64 = result.split(',')[1];
                    const url = `https://api.github.com/repos/${owner}/${repo}/contents/${filePath}`;
                    const res = await fetch(url, {
                        method:"PUT",
                        headers:{ "Authorization":"token "+token, "Accept":"application/vnd.github+json" },
                        body:JSON.stringify({ message:commitMsg, content:base64, branch:branch })
                    });
                    if(res.ok){ count++; }else{ failed++; }
                    resolve();
                };
                reader.readAsDataURL(file);
            });
        }
        showStatus(`ä¸Šä¼ å®Œæˆï¼š${count} ä¸ªæ–‡ä»¶ï¼Œå¤±è´¥ï¼š${failed} ä¸ªã€‚`);
        loadFiles(curPath);
    };
    window.showNewFile = function(){
        document.getElementById("ghTopActions").innerHTML = `
            <input id="newFileName" type="text" style="width:180px;" placeholder="æ–‡ä»¶å.txt">
            <button onclick="createFile()" class="btn btn-primary btn-sm">åˆ›å»º</button>
            <button onclick="cancelEdit()" class="btn btn-danger btn-sm">å–æ¶ˆ</button>
        `;
    }
    window.showNewDir = function(){
        document.getElementById("ghTopActions").innerHTML = `
            <input id="newDirName" type="text" style="width:180px;" placeholder="ç›®å½•å">
            <button onclick="createDir()" class="btn btn-primary btn-sm">åˆ›å»º</button>
            <button onclick="cancelEdit()" class="btn btn-danger btn-sm">å–æ¶ˆ</button>
        `;
    }
    window.cancelEdit = function(){ showActionsBar(); };
    window.createFile = async function(){
        let fileName = document.getElementById("newFileName").value.trim();
        if(!fileName) return showStatus("è¯·è¾“å…¥æ–‡ä»¶å", "#cf222e");
        let filePath = curPath?curPath+"/"+fileName:fileName;
        let token = localStorage.getItem("gh_token")||""; if(!token){ token = ""; }
        showStatus("æ­£åœ¨åˆ›å»º...", "#0969da");
        const url = `https://api.github.com/repos/${owner}/${repo}/contents/${filePath}`;
        const res = await fetch(url, {
            method:"PUT",
            headers:{ "Authorization":"token "+token, "Accept":"application/vnd.github+json" },
            body:JSON.stringify({ message:commitMsg, content:btoa(""), branch:branch })
        });
        const data = await res.json();
        if(res.ok){ showStatus("åˆ›å»ºæˆåŠŸï¼"); loadFiles(curPath);}
        else{ showStatus("åˆ›å»ºå¤±è´¥: "+(data.message||""), "#cf222e"); }
    }
    window.createDir = async function(){
        let dirName = document.getElementById("newDirName").value.trim();
        if(!dirName) return showStatus("è¯·è¾“å…¥ç›®å½•å", "#cf222e");
        let filePath = curPath?curPath+"/"+dirName+"/.keep":dirName+"/.keep";
        let token = localStorage.getItem("gh_token")||""; if(!token){ token = ""; }
        showStatus("æ­£åœ¨åˆ›å»ºç›®å½•...", "#0969da");
        const url = `https://api.github.com/repos/${owner}/${repo}/contents/${filePath}`;
        const res = await fetch(url, {
            method:"PUT",
            headers:{ "Authorization":"token "+token, "Accept":"application/vnd.github+json" },
            body:JSON.stringify({ message:commitMsg, content:btoa("This is a placeholder file for directory."), branch:branch })
        });
        const data = await res.json();
        if(res.ok){ showStatus("ç›®å½•åˆ›å»ºæˆåŠŸï¼"); loadFiles(curPath);}
        else{ showStatus("åˆ›å»ºå¤±è´¥: "+(data.message||""), "#cf222e"); }
    }
    // ä»¿Star/ForkæŒ‰é’®
    function starRepo(){ window.open(`https://github.com/${owner}/${repo}/stargazers`,"_blank"); }
    function forkRepo(){ window.open(`https://github.com/${owner}/${repo}/fork`,"_blank"); }

    // ä¸ºæ–°æ–‡ä»¶/ç›®å½•æ“ä½œæ ä¿ç•™
    document.getElementById("ghFiles").insertAdjacentHTML("beforebegin", `<div id="ghTopActions"></div>`);

    // åˆå§‹åŒ–
    showTab("code");
    </script>
</body>
</html>
