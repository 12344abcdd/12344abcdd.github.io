<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>共享文本编辑器</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2em; }
        textarea { width: 100%; height: 200px; font-size: 1.1em; }
        #saveStatus { color: green; margin-top: 0.5em; }
    </style>
</head>
<body>
    <h2>共享文本编辑器</h2>
    <p>任何人都可以查看和修改下面的内容，内容会自动保存到 shared.txt 文件。</p>
    <textarea id="sharedText"></textarea>
    <div>
      <button id="saveBtn">保存</button>
      <span id="saveStatus"></span>
    </div>
    <p style="color:#e00;font-size:0.95em;">
      当前网页已内置 GitHub Token，请勿在生产环境使用！
    </p>
    <script>
    const owner = "abcdd12344";
    const repo = "abcdd12344.github.io";
    const path = "shared.txt";
    let fileSha = "";

    // === <<< 在这里硬编码你的 Token >>> ===
    const token = "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"; // ←← 填你的 token

    // 获取 shared.txt 内容
    async function fetchSharedText() {
        const url = `https://api.github.com/repos/${owner}/${repo}/contents/${path}?t=${Date.now()}`;
        const res = await fetch(url);
        if (!res.ok) {
            document.getElementById("sharedText").value = "(文件不存在或无法读取)";
            return;
        }
        const data = await res.json();
        fileSha = data.sha;
        document.getElementById("sharedText").value = atob(data.content.replace(/\n/g, ""));
    }

    // 保存内容到 shared.txt
    async function saveSharedText() {
        const content = btoa(unescape(encodeURIComponent(document.getElementById("sharedText").value)));
        const url = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
        document.getElementById("saveStatus").textContent = "保存中...";
        const res = await fetch(url, {
            method: "PUT",
            headers: {
                "Authorization": "token " + token,
                "Accept": "application/vnd.github+json"
            },
            body: JSON.stringify({
                message: "Update shared.txt via web",
                content: content,
                sha: fileSha
            })
        });
        const data = await res.json();
        if (res.ok) {
            fileSha = data.content.sha;
            document.getElementById("saveStatus").textContent = "保存成功！";
        } else {
            document.getElementById("saveStatus").textContent = "保存失败: " + (data.message || "");
        }
        setTimeout(() => document.getElementById("saveStatus").textContent = "", 3000);
    }

    // 保存按钮绑定
    document.getElementById("saveBtn").onclick = saveSharedText;

    // 自动刷新内容
    setInterval(fetchSharedText, 10000);

    // 页面加载时获取内容
    fetchSharedText();

    </script>
</body>
</html>
