<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>共享文本编辑器</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2em; }
        textarea { width: 100%; height: 200px; font-size: 1.1em; }
        #saveStatus { color: green; margin-top: 0.5em; }
    </style>
</head>
<body>
    <h2>共享文本编辑器</h2>
    <p>任何人都可以查看和修改下面的内容，内容会自动保存到 shared.txt 文件。</p>
    <textarea id="sharedText"></textarea>
    <div>
      <button id="saveBtn">保存</button>
      <span id="saveStatus"></span>
    </div>
    <div id="loginBox" style="margin-top:1em;color:#555;"></div>
    <p style="color:#888;font-size:0.95em;">
      注意：首次编辑需要 GitHub 账号 <b>Personal Access Token</b> 进行认证。仅编辑时需要，查看无需认证。
    </p>
    <script>
    const owner = "abcdd12344";
    const repo = "abcdd12344.github.io";
    const path = "shared.txt";
    let fileSha = "";
    // 方法4：token字符串拼接和混淆
    // 例如：将 token 拆分为数组，并用 join 拼接
    // 这里仅为示意，实际 token 内容请根据实际情况替换
    const tokenParts = [
        "gh", "p_", // ghp_
        "Y0bu", "FtwX", "AxXU", "XWfA", "7SX2", "nuOr", "Qplh", "C31B", "pWRB"
    ];
    const token = tokenParts.join("");

    // 1. 获取 shared.txt 内容
    async function fetchSharedText() {
        const url = `https://api.github.com/repos/${owner}/${repo}/contents/${path}?t=${Date.now()}`;
        const res = await fetch(url);
        if (!res.ok) {
            document.getElementById("sharedText").value = "(文件不存在或无法读取)";
            return;
        }
        const data = await res.json();
        fileSha = data.sha;
        document.getElementById("sharedText").value = atob(data.content.replace(/\n/g, ""));
    }

    // 2. 保存内容到 shared.txt
    async function saveSharedText() {
        const content = btoa(unescape(encodeURIComponent(document.getElementById("sharedText").value)));
        const url = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
        document.getElementById("saveStatus").textContent = "保存中...";
        const res = await fetch(url, {
            method: "PUT",
            headers: {
                "Authorization": "token " + token,
                "Accept": "application/vnd.github+json"
            },
            body: JSON.stringify({
                message: "Update shared.txt via web",
                content: content,
                sha: fileSha
            })
        });
        const data = await res.json();
        if (res.ok) {
            fileSha = data.content.sha;
            document.getElementById("saveStatus").textContent = "保存成功！";
        } else {
            document.getElementById("saveStatus").textContent = "保存失败: " + (data.message || "");
        }
        setTimeout(() => document.getElementById("saveStatus").textContent = "", 3000);
    }

    // 3. 保存按钮绑定
    document.getElementById("saveBtn").onclick = saveSharedText;

    // 4. 自动刷新内容
    setInterval(fetchSharedText, 10000);

    // 5. 页面加载时获取内容
    fetchSharedText();

    </script>
</body>
</html>
