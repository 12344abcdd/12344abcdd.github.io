<!DOCTYPE html>
<html>
<head>
    <title>GitHub 协作记事本</title>
    <style>
        body { font-family: Arial; max-width: 800px; margin: 0 auto; padding: 20px; }
        #editor { width: 100%; height: 400px; border: 1px solid #ccc; padding: 10px; }
        #status { margin-top: 10px; color: #666; }
    </style>
</head>
<body>
    <h1>GitHub 协作记事本</h1>
    <textarea id="editor"></textarea>
    <button id="save">保存到 GitHub</button>
    <p id="status">正在加载...</p>
    
    <script>
        const editor = document.getElementById('editor');
        const saveBtn = document.getElementById('save');
        const status = document.getElementById('status');
        let fileSha = ''; // 存储文件的sha值

        // 从 GitHub 获取内容
        async function loadContent() {
            try {
                const response = await fetch('https://api.github.com/repos/abcdd12344/abcdd12344.github.io/contents/shared.txt');
                if (!response.ok) {
                    if (response.status === 404) {
                        status.textContent = '文件不存在，请先创建shared.txt';
                        return;
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                editor.value = atob(data.content);
                fileSha = data.sha; // 保存sha值
                status.textContent = '内容已加载';
            } catch (error) {
                status.textContent = '无法加载内容: ' + error.message;
                console.error('加载错误:', error);
            }
        }
        
        // 保存内容到 GitHub
        async function saveContent() {
            const content = btoa(editor.value);
            const message = `Update at ${new Date().toISOString()}`;
            
            try {
                const response = await fetch('https://api.github.com/repos/abcdd12344/abcdd12344.github.io/contents/shared.txt', {
                    method: 'PUT',
                    headers: {
                        'Authorization': 'token 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', // 替换为真实token
                        'Content-Type': 'application/json',
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: JSON.stringify({
                        message: message,
                        content: content,
                        sha: fileSha // 使用保存的sha值
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                fileSha = result.content.sha; // 更新sha值
                status.textContent = '内容已保存';
            } catch (error) {
                status.textContent = '保存失败: ' + error.message;
                console.error('保存错误:', error);
            }
        }
        
        saveBtn.addEventListener('click', saveContent);
        loadContent();
    </script>
</body>
</html>
